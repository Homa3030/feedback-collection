{% extends "layout.html" %}
{% block content %}
<h2>Question constructor</h2>
    <div class="btn-group">

      <button type="button" class="btn btn-primary dropdown-toggle mb-3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Choose type of question
      </button>

  <div class="dropdown-menu">
      <button type="button" class="dropdown-item" data-toggle="modal" data-target="#OpenEnded" >Open ended questions</button>
    <button type="button" class="dropdown-item" data-toggle="modal" data-target="#ClosedEnded" >Closed ended questions</button>

    <div class="dropdown-divider"></div>
    <button type="button" class="dropdown-item" data-toggle="modal" data-target="#Comment" >Add comment</button>
  </div>
</div>

    <div class="modal fade" id="Comment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Comment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Comment:</label>
            <textarea class="form-control" id="Comment1"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="SaveC" data-dismiss="modal">Save</button>
      </div>
    </div>
  </div>
</div>
  <div class="modal fade" id="ClosedEnded" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New Question</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="question" class="col-form-label">Question:</label>
            <input type="text" class="form-control" id="Cquestion">
          </div>
        </form>
            <input type="text" class="form-control" id="Variant1" placeholder="Add possible variant">
            <input type="text" class="form-control" id="Variant2" placeholder="Add possible variant">
            <input type="text" class="form-control" id="Variant3" placeholder="Add possible variant">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="SaveCQ">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="OpenEnded" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New Question</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="question" class="col-form-label">Question:</label>
            <input type="text" class="form-control" id="Oquestion">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Comment:</label>
            <textarea class="form-control" id="CommentO"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">

<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="SaveOQ" data-dismiss="modal">Save</button>
      </div>
    </div>
  </div>
</div>

    <div  id="survey"></div>
    <div>


    </div>

      <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
 Save
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to proceed?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a class="btn btn-primary" href="/" role="button">Finish</a>
      </div>
    </div>
  </div>
</div>

<script>
function openQuestion() {
    var question = document.getElementById('Oquestion').value;
    var comment = document.getElementById('CommentO').value;
    var id;


    var FormID = {{formID}};
    theUrl='/add_question?form_id=' + FormID + '&question=' + question;

    xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        id = JSON.parse(xmlhttp.responseText)['id'];
     }
    };
    xmlhttp.open("POST", theUrl, false);
    xmlhttp.send();

    var open_q_test = document.createElement('div');
    open_q_test.className= 'card mb-3';
    open_q_test.style= 'max-width: 20rem;';
    open_q_test.id = String(id);
    
    var div1_q = document.createElement('div');
    div1_q.className= 'card-header';
    div1_q.innerHTML = 'Open Ended Question';

    var div2_q = document.createElement('div');
    div2_q.className= 'card-body';
    
    var h5 = document.createElement('h5');
    h5.className= 'card-title';
    h5.innerHTML= question;

    var p = document.createElement('p');
    p.className = 'text-muted';
    p.innerHTML = 'Comment: ' + comment;

    var but = document.createElement('button');
    but.addEventListener('click', function(){
      var removable = document.getElementById(String(id));
      document.getElementById('survey').removeChild(removable);

    xmlhttp = new XMLHttpRequest();
    theUrl = "/delete_question?form_id=" + FormID + "&question_id=" + id;
    xmlhttp.open("POST", theUrl, false);
    xmlhttp.send();

    });
    but.innerHTML="Delete";
    but.className = 'btn btn-secondary';
    
    div2_q.appendChild(h5);
    div2_q.appendChild(p);
    div2_q.appendChild(but);
    open_q_test.appendChild(div1_q);
    open_q_test.appendChild(div2_q);

    document.getElementById('survey').appendChild(open_q_test);

    // var html = '<div class="card mb-3" style="max-width: 20rem;">\n' +
    //     '  <div class="card-header">Open Ended Question</div>\n' +
    //     '  <div class="card-body">\n' +
    //     '    <h5 class="card-title">'+question+'</h5>\n' +
    //     '    <p class="text-muted">Comment: '+comment+'</p>\n' +
    //     '    <button type="button" class="btn btn-secondary">D</button>\n'+
    //     '  </div>\n' +
    //     '</div>';

    //document.getElementById('survey').innerHTML += html;

}

function comment() {
    var comment_v = document.getElementById('Comment1').value;
    var id;


  var FormID = {{formID}};
  theUrl='/add_question?form_id=' + FormID + '&question=' + comment_v;

  xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
  if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
    id = JSON.parse(xmlhttp.responseText)['id'];
    }
  };
  xmlhttp.open("POST", theUrl, false);
  xmlhttp.send();

  var comment_test = document.createElement('div');
    comment_test.className= 'card mb-3';
    comment_test.style= 'max-width: 20rem;';
    comment_test.id = String(id);
    
    var div1_q = document.createElement('div');
    div1_q.className= 'card-header';
    div1_q.innerHTML = 'Comment';

    var div2_q = document.createElement('div');
    div2_q.className= 'card-body';
    
    var h5 = document.createElement('h5');
    h5.className= 'card-title';
    h5.innerHTML= comment_v;

    var but = document.createElement('button');
    but.addEventListener('click', function(){
      var removable = document.getElementById(String(id));
      document.getElementById('survey').removeChild(removable);

    xmlhttp = new XMLHttpRequest();
    theUrl = "/delete_question?form_id=" + FormID + "&question_id=" + id;
    xmlhttp.open("POST", theUrl, false);
    xmlhttp.send();

    });
    but.innerHTML="Delete";
    but.className = 'btn btn-secondary';
    
    div2_q.appendChild(h5);
    div2_q.appendChild(but);
    comment_test.appendChild(div1_q);
    comment_test.appendChild(div2_q);

    document.getElementById('survey').appendChild(comment_test);

    // var html = '<div class="card mb-3" style="max-width: 20rem;">\n' +
    //     '  <div class="card-header">Comment</div>\n' +
    //     '  <div class="card-body">\n' +
    //     '    <h5 class="card-title">'+comment+'</h5>\n' +
    //     '  </div>\n' +
    //     '</div>';

    // document.getElementById('survey').innerHTML += html;

}

function closedQuestion() {
    var question = document.getElementById('Cquestion').value;
    var var1 = document.getElementById('Variant1').value;
    var var2 = document.getElementById('Variant2').value;
    var var3 = document.getElementById('Variant3').value;
    var id;

    var FormID = {{formID}};
    theUrl='/add_question?form_id=' + FormID + '&question=' + question + '&answers=' + var1 + ',' + var2 + ',' + var3;

    xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        id = JSON.parse(xmlhttp.responseText)['id'];
     }
    };
    xmlhttp.open("POST", theUrl, false);
    xmlhttp.send();

    var html = '<div class="card mb-3" id="div'+ String(id)+'" style="max-width: 20rem;">\n' +
        '  <div class="card-header">Closed Ended Question</div>\n' +
        '  <div class="card-body">\n' +
        '    <h5 class="card-title">'+question+'</h5>\n' +
        '<div class="form-check">\n' +
        '  <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">\n' +
        '  <label class="form-check-label" for="defaultCheck1">\n' + var1 +
        '  </label>\n' +
        '</div>\n' +
        '<div class="form-check">\n' +
        '  <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">\n' +
        '  <label class="form-check-label" for="defaultCheck1">\n' + var2 +
        '  </label>\n' +
        '</div>\n'+
        '<div class="form-check">\n' +
        '  <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">\n' +
        '  <label class="form-check-label" for="defaultCheck1">\n' + var3 +
        '  </label>\n' +
        '</div>\n' +
        '<button type="button" id="btn'+String(id)+'" class="btn btn-secondary">Delete</button>\n'+
        '  </div>\n' +
        '</div>';

    document.getElementById('survey').innerHTML += html;

    document.getElementById('btn' + String(id)).addEventListener('click', function(){
      var removable = document.getElementById('div' + String(id));
      document.getElementById('survey').removeChild(removable);

    xmlhttp = new XMLHttpRequest();
    theUrl = "/delete_question?form_id=" + FormID + "&question_id=" + id;
    xmlhttp.open("POST", theUrl, false);
    xmlhttp.send();
    });
}

    document.getElementById('SaveOQ').addEventListener('click', openQuestion);
    document.getElementById('SaveCQ').addEventListener('click', closedQuestion);
    document.getElementById('SaveC').addEventListener('click', comment);
    
</script>
{% endblock %}